<!DOCTYPE html>
<!-- A tag 'lang' é importante para acessibilidade e para os navegadores entenderem o idioma da página. -->
<html lang="pt-BR">
<head>
    <!-- Configurações essenciais do cabeçalho da página (head) -->
    <meta charset="UTF-8"> <!-- Define o conjunto de caracteres como UTF-8, que suporta acentos e caracteres especiais. -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Garante que a página se adapte bem a telas de diferentes tamanhos, como celulares. -->
    <title>Protótipo Interativo - Painel do Fiscal</title>

    <!-- Importação do Tailwind CSS: a ferramenta que usamos para estilizar tudo de forma rápida. -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Importação da fonte 'Inter' do Google Fonts: para deixar o texto mais bonito e moderno. -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos CSS personalizados para detalhes que o Tailwind não cobre ou para organização. -->
    <style>
        /* Define a fonte 'Inter' como padrão para todo o corpo da página. */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Um cinza bem claro para o fundo. */
        }
        /* Classe para esconder as telas que não estão ativas. O JavaScript controla isso. */
        .screen {
            display: none;
        }
        /* Estilo para o fundo do modal: O desfoque (backdrop-filter) dá um efeito de profundidade, focando a atenção na janela. */
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(2px);
        }
        /* Classes de estilo para os indicadores de risco, usando as cores do Tailwind. */
        .risk-high { background-color: #fecaca; color: #b91c1c; } /* Vermelho para risco alto */
        .risk-medium { background-color: #fed7aa; color: #b45309; } /* Laranja para risco médio */
        .risk-low { background-color: #d1fae5; color: #065f46; } /* Verde para risco baixo */

        /* Estilo para a notificação (toast). Fica escondida por padrão. */
        #toast {
            position: fixed; /* Posição fixa na tela, mesmo com rolagem. */
            top: 20px; /* Distância do topo. */
            right: 20px; /* Distância da direita. */
            transform: translateX(200%); /* Começa fora da tela para a animação de entrada. */
            transition: transform 0.3s ease-in-out; /* Animação suave. */
            z-index: 100; /* Garante que fique acima de tudo. */
        }
        #toast.show {
            transform: translateX(0); /* Move a notificação para dentro da tela. */
        }

        /* Classes para os status na tabela */
        .status-pendente { background-color: #fef3c7; color: #92400e; }
        .status-aprovado { background-color: #d1fae5; color: #065f46; }
        .status-rejeitado { background-color: #fee2e2; color: #991b1b; }

        /* Estilos para as ABAS dentro do MODAL */
        .tab-content {
            display: none; /* Esconde o conteúdo da aba por padrão */
        }
        .tab-content.active {
            display: block; /* Mostra o conteúdo da aba ativa */
        }
        /* Estiliza o botão da aba ativa */
        .tab-button.active {
            border-bottom: 2px solid #16a34a; /* Linha verde embaixo */
            color: #16a34a; /* Texto verde */
            font-weight: 600;
        }

        /* Esconde elementos com a classe .hidden */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <!-- ====================================================================== -->
    <!-- ESTRUTURA DA TELA DE LOGIN                                             -->
    <!-- Centralizada na página para foco total do usuário.                      -->
    <!-- ====================================================================== -->
    <div id="login-screen" class="screen h-screen flex items-center justify-center">
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-8 m-4">
            <div class="flex flex-col items-center mb-6">
                <div class="bg-green-100 p-3 rounded-full mb-4"><svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg></div>
                <h1 class="text-2xl font-bold text-gray-800">Acesso do Fiscal</h1>
                <p class="text-gray-500 mt-1">Bem-vindo(a) de volta!</p>
            </div>
            
            <!-- O onsubmit agora chama uma função que simula o carregamento. -->
            <form id="login-form">
                <div class="mb-5">
                    <label for="cpf-login" class="block mb-2 text-sm font-medium text-gray-700">CPF</label>
                    <input type="text" id="cpf-login" class="cpf-mask bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5" placeholder="000.000.000-00">
                </div>
                <div class="mb-6">
                    <label for="password" class="block mb-2 text-sm font-medium text-gray-700">Senha</label>
                    <div class="relative">
                        <input type="password" id="password" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5 pr-10" placeholder="••••••••">
                        <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer" aria-label="Mostrar ou esconder a senha">
                            <svg id="eye-icon" class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                            <svg id="eye-slash-icon" class="h-5 w-5 text-gray-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l18 18"></path></svg>
                        </button>
                    </div>
                </div>
                <a href="#" onclick="showScreen('esqueci-senha-screen')" class="text-sm text-green-600 hover:underline mb-6 block text-center">Esqueceu sua senha?</a>
                <!-- O botão de login agora tem um ID para ser controlado pelo JavaScript. -->
                <button type="submit" id="login-button" class="w-full text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-3 text-center transition-colors flex justify-center items-center">
                    Entrar no Painel
                </button>
            </form>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- ESTRUTURA DA TELA DE RECUPERAÇÃO DE SENHA                              -->
    <!-- ====================================================================== -->
    <div id="esqueci-senha-screen" class="screen h-screen flex items-center justify-center">
        <!-- O conteúdo é idêntico ao anterior, pois já estava bem estruturado. -->
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl p-8 m-4">
            <div class="flex flex-col items-center mb-6">
                <div class="bg-blue-100 p-3 rounded-full mb-4"><svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div>
                <h1 class="text-2xl font-bold text-gray-800">Recuperação de Senha</h1>
                <p class="text-gray-500 mt-1 text-center">Digite seu CPF para iniciarmos o processo de recuperação.</p>
            </div>
            <form onsubmit="event.preventDefault(); showToast('Instruções enviadas com sucesso!', 'success'); showScreen('login-screen');">
                <div class="mb-5">
                    <label for="cpf-recuperacao" class="block mb-2 text-sm font-medium text-gray-700">CPF</label>
                    <input type="text" id="cpf-recuperacao" class="cpf-mask bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="000.000.000-00">
                </div>
                <button type="submit" class="w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-3 text-center transition-colors mb-4">
                    Enviar Instruções
                </button>
                <a href="#" onclick="showScreen('login-screen')" class="text-sm text-gray-600 hover:underline block text-center">Lembrou a senha? Voltar para o Login</a>
            </form>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- ESTRUTURA DA TELA DO PAINEL DO FISCAL (MODIFICADA)                     -->
    <!-- ====================================================================== -->
    <div id="fiscal-screen" class="screen">
        <!-- O cabeçalho permanece o mesmo, fixo no topo. -->
        <header class="bg-white shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-green-700">Painel de Fiscalização</h1>
                <div class="flex items-center space-x-4">
                    <span class="hidden sm:block text-sm">Fiscal: Carlos Mendes</span>
                    <a href="#" onclick="showScreen('login-screen')" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">Sair</a>
                </div>
            </div>
        </header>

        <!-- Conteúdo principal do painel, agora com as novas estatísticas e a tabela. -->
        <main class="container mx-auto px-6 py-8">
            
            <!-- NOVA ORDEM: Resumo Anual e Eficiência (VEIO PARA CIMA) -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Resumo Anual e Eficiência</h2>
            <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-5 rounded-lg shadow text-center">
                    <p class="text-sm text-gray-500">Solicitações (Ano)</p>
                    <p class="text-3xl font-bold text-gray-800">530</p>
                </div>
                <div class="bg-white p-5 rounded-lg shadow text-center">
                    <p class="text-sm text-gray-500">Em Aberto (Ano)</p>
                    <p class="text-3xl font-bold text-yellow-600">45</p>
                </div>
                <div class="bg-white p-5 rounded-lg shadow text-center">
                    <p class="text-sm text-gray-500">Atendidas (Ano)</p>
                    <p class="text-3xl font-bold text-green-600">485</p>
                </div>
                <!-- Card de Destaque para Eficiência -->
                <div class="bg-green-600 text-white p-5 rounded-lg shadow text-center flex flex-col justify-center">
                    <p class="text-sm font-semibold opacity-90">Índice de Eficiência</p>
                    <p class="text-4xl font-bold">91.5%</p>
                </div>
            </section>

            <!-- NOVA ORDEM: Estatísticas Mensais (AGORA ESTÁ ABAIXO DA ANUAL) -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Estatísticas Mensais</h2>
            <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Card 1: Solicitações Feitas no Mês -->
                <div class="bg-blue-100 p-6 rounded-lg shadow flex items-center">
                    <div class="bg-blue-500 p-3 rounded-full text-white mr-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-blue-800">67</p>
                        <p class="text-blue-700 font-semibold">Solicitações Feitas (Mês)</p>
                    </div>
                </div>
                <!-- Card 2: Solicitações Em Aberto -->
                <div class="bg-yellow-100 p-6 rounded-lg shadow flex items-center">
                    <div class="bg-yellow-500 p-3 rounded-full text-white mr-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-yellow-800">12</p>
                        <p class="text-yellow-700 font-semibold">Em Aberto (Mês)</p>
                    </div>
                </div>
                <!-- Card 3: Solicitações Atendidas (Aprovadas + Rejeitadas) -->
                <div class="bg-green-100 p-6 rounded-lg shadow flex items-center">
                    <div class="bg-green-500 p-3 rounded-full text-white mr-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-green-800">55</p>
                        <p class="text-green-700 font-semibold">Atendidas (Mês)</p>
                    </div>
                </div>
            </section>
            
            <!-- SEÇÃO MODIFICADA: Lista de Solicitações (em Tabela) -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Relação de Solicitações</h2>
            <!-- Filtros (permanecem iguais) -->
            <div class="bg-white p-4 rounded-lg shadow-md mb-8">
                <form id="filter-form" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <input type="text" placeholder="Buscar por protocolo ou endereço..." class="col-span-1 md:col-span-2 lg:col-span-2 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    <select class="p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"><option value="">Todos os Status</option><option value="pendente">Pendente</option><option value="aprovado">Aprovado</option><option value="rejeitado">Rejeitado</option></select>
                    <button type="submit" id="filter-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><span>Filtrar</span></button>
                </form>
            </div>
            
            <!-- Container da Tabela: 'overflow-x-auto' é crucial para a responsividade em telas pequenas. -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full min-w-max"> <!-- 'min-w-max' garante que a tabela não se comprima demais. -->
                        <!-- Cabeçalho da tabela -->
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="text-left py-3 px-4 font-semibold text-gray-600 text-sm">Protocolo</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-600 text-sm">Data</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-600 text-sm">Endereço</th>
                                <th class="text-left py-3 px-4 font-semibold text-gray-600 text-sm">Solicitante</th>
                                <th class="text-center py-3 px-4 font-semibold text-gray-600 text-sm">Risco</th>
                                <th class="text-center py-3 px-4 font-semibold text-gray-600 text-sm">Status</th>
                                <th class="text-center py-3 px-4 font-semibold text-gray-600 text-sm">Ações</th>
                            </tr>
                        </thead>
                        <!-- Corpo da tabela com os dados -->
                        <tbody class="divide-y divide-gray-200">
                            <!-- Dados em ordem DECRESCENTE de data (mais recentes primeiro) -->
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 text-gray-800">#2025001</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">09/10/2025</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">R. das Flores, 123</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">Ana Silva</td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-bold px-2 py-1 rounded-full risk-high">ALTO</span></td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-semibold px-2.5 py-1 rounded-full status-pendente">Pendente</span></td>
                                <td class="py-3 px-4 text-center">
                                    <!-- **MUDANÇA** Chama openModal com isReadOnly = false -->
                                    <button onclick="openModal('2025001', false)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-sm transition-colors">Analisar</button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 text-gray-800">#2025004</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">08/10/2025</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">Av. Bady Bassitt, 4580</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">João Pereira</td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-bold px-2 py-1 rounded-full risk-medium">MÉDIO</span></td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-semibold px-2.5 py-1 rounded-full status-pendente">Pendente</span></td>
                                <td class="py-3 px-4 text-center">
                                    <button onclick="openModal('2025004', false)" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-lg text-sm transition-colors">Analisar</button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 text-gray-800">#2025002</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">07/10/2025</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">Av. Principal, 789</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">Bruno Costa</td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-bold px-2 py-1 rounded-full risk-low">BAIXO</span></td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-semibold px-2.5 py-1 rounded-full status-aprovado">Aprovado</span></td>
                                <td class="py-3 px-4 text-center">
                                    <!-- **MUDANÇA** Botão habilitado, chama openModal com isReadOnly = true -->
                                    <button onclick="openModal('2025002', true)" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-1 px-3 rounded-lg text-sm transition-colors">Ver</button>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 text-gray-800">#2025003</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">05/10/2025</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">R. da Saudade, 321</td>
                                <td class="py-3 px-4 text-gray-600 text-sm">Maria Oliveira</td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-bold px-2 py-1 rounded-full risk-medium">MÉDIO</span></td>
                                <td class="py-3 px-4 text-center"><span class="text-xs font-semibold px-2.5 py-1 rounded-full status-rejeitado">Rejeitado</span></td>
                                <td class="py-3 px-4 text-center">
                                    <!-- **MUDANÇA** Botão habilitado, chama openModal com isReadOnly = true -->
                                    <button onclick="openModal('2025003', true)" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-1 px-3 rounded-lg text-sm transition-colors">Ver</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- ====================================================================== -->
    <!-- JANELA MODAL DE ANÁLISE (COMPLETAMENTE REFEITA COM ABAS)               -->
    <!-- Esta é a maior mudança, baseada nos PDFs.                              -->
    <!-- ====================================================================== -->
    <div id="requestModal" onclick="if (event.target.id === 'requestModal') closeModal()" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop p-4">
        
        <!-- **MUDANÇA NA LARGURA**: Alterado de 'max-w-4xl' para 'max-w-3xl' para evitar barra de rolagem horizontal -->
        <div class="bg-white rounded-xl shadow-2xl w-full md:max-w-3xl flex flex-col max-h-[90vh]">
            
            <!-- Cabeçalho do Modal -->
            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Análise da Solicitação - #<span id="modalProtocol"></span></h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-3xl font-bold" aria-label="Fechar janela">&times;</button>
            </div>

            <!-- Botões das Abas -->
            <div class="border-b border-gray-200 flex-shrink-0">
                <nav class="flex space-x-4 px-6">
                    <!-- **CORREÇÃO DE BUG/FONTE**: Corrigido 'class_s' para 'class' -->
                    <button class="tab-button active py-3 px-2 text-sm" onclick="showTab('tab-detalhes')">
                        1. Detalhes da Solicitação
                    </button>
                    <!-- Botão da Aba 2 (Laudo) -->
                    <button class="tab-button py-3 px-2 text-sm text-gray-600" onclick="showTab('tab-laudo')">
                        2. Laudo de Vistoria
                    </button>
                </nav>
            </div>

            <!-- Container das Abas (com rolagem) -->
            <div class="flex-grow overflow-y-auto">
                
                <!-- =========================================== -->
                <!-- CONTEÚDO DA ABA 1: DETALHES DA SOLICITAÇÃO  -->
                <!-- **CORRIGIDO** com mais campos do ReqPodaSupressao.pdf -->
                <!-- =========================================== -->
                <div id="tab-detalhes" class="tab-content active p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        <!-- Coluna da Esquerda: Dados da Solicitação -->
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">Informações do Solicitante</h3>
                            <!-- **MUDANÇA NA FONTE**: Adicionado 'text-sm' em cada <p> para padronizar -->
                            <div class="space-y-3">
                                <!-- Dados simulados do ReqPodaSupressao.pdf -->
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">Nome:</strong> Ana Silva</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">CPF:</strong> 123.456.789-00</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">RG:</strong> 22.333.444-5</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">Telefone:</strong> (17) 99999-8888</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">Email:</strong> ana.silva@email.com</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">Endereço:</strong> R. das Flores, 123</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">Bairro:</strong> Jd. das Palmeiras</p>
                                <p class="text-sm"><strong class="text-gray-600 w-24 inline-block">CEP:</strong> 15000-000</p>
                            </div>

                            <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-4 border-b pb-2">Dados da Solicitação</h3>
                            <!-- **MUDANÇA NA FONTE**: Adicionado 'text-sm' em cada <p> para padronizar -->
                            <div class="space-y-3">
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Tipo de Solicitação:</strong> SUPRESSÃO</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Qtd. Solicitada:</strong> 1</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Endereço da Árvore:</strong> R. das Flores, 123 (mesmo do solicitante)</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Ponto de Ref.:</strong> Próximo à padaria</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Local da Árvore:</strong> Calçada com fiação</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Tipo de Imóvel:</strong> Residencial</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Relação:</strong> Proprietário</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Podador:</strong> Não informado</p>
                                <p class="text-sm"><strong class="text-gray-600 w-32 inline-block">Local Retirada:</strong> Poupatempo</p>
                            </div>
                        </div>
                        
                        <!-- Coluna da Direita: Fotos e Justificativa -->
                        <div>
                             <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">Justificativa do Cidadão</h3>
                            <p class="text-gray-700 bg-gray-50 p-3 rounded-lg text-sm mb-6">"Galhos tocando a fiação elétrica e risco de queda sobre a calçada. A árvore parece estar com muitas folhas secas."</p>
                            
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">Evidências</h3>
                            <!-- Foto da Árvore -->
                            <h4 class="font-semibold text-gray-700 mb-2">Foto da Árvore</h4>
                            <img src="https://placehold.co/600x400/a0aec0/ffffff?text=Foto+da+Árvore" alt="Foto da Árvore" class="object-cover w-full h-auto rounded-lg mb-4">
                            
                            <!-- Localização (Mapa) -->
                            <h4 class="font-semibold text-gray-700 mb-2">Localização</h4>
                            <div class="bg-gray-200 rounded-lg w-full h-40 flex items-center justify-center text-gray-500 mb-4">[IMAGEM DO MAPA]</div>
                            
                            <!-- **MUDANÇA** Removi a seção de "Documentos Anexados" que estava errada -->
                        </div>
                    </div>
                </div>

                <!-- =========================================== -->
                <!-- CONTEÚDO DA ABA 2: PREENCHER LAUDO          -->
                <!-- **CORRIGIDO** Fiel ao Itens-Laudo.pdf        -->
                <!-- =========================================== -->
                <div id="tab-laudo" class="tab-content p-6">
                    <!-- O fieldset é usado para desabilitar o formulário inteiro no modo de leitura -->
                    <fieldset id="laudo-fieldset">
                        <form id="laudo-form">
                            <!-- **NOVO CAMPO** Laudo para Poda ou Supressão -->
                            <div class="mb-6">
                                <h4 class="font-semibold text-gray-700 mb-2">Laudo de Autorização para:</h4>
                                <!-- **MUDANÇA NA FONTE**: Adicionado 'text-sm' -->
                                <div class="flex space-x-4"><label class="flex items-center text-sm"><input type="radio" name="tipo-laudo" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">PODA</label><label class="flex items-center text-sm"><input type="radio" name="tipo-laudo" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2" checked>SUPRESSÃO</label></div>
                            </div>

                            <!-- Seção de Endereço (Pré-preenchido do pedido) -->
                            <!-- **MUDANÇA NO TÍTULO**: Removido "(Reaproveitado)" -->
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">Local da Vistoria</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div class="md:col-span-2">
                                    <!-- **MUDANÇA NA LABEL**: Removido "(pré-preenchido)" -->
                                    <label class="font-semibold text-gray-700">Endereço</label>
                                    <input type="text" value="R. das Flores" class="mt-1 w-full p-2 bg-gray-100 border border-gray-300 rounded-lg" readonly>
                                </div>
                                <div>
                                    <label class="font-semibold text-gray-700">Nº</label>
                                    <input type="text" value="123" class="mt-1 w-full p-2 bg-gray-100 border border-gray-300 rounded-lg" readonly>
                                </div>
                                <div class="md:col-span-3">
                                    <label class="font-semibold text-gray-700">Bairro</label>
                                    <input type="text" value="Jd. das Palmeiras" class="mt-1 w-full p-2 bg-gray-100 border border-gray-300 rounded-lg" readonly>
                                </div>
                            </div>
                            <hr class="my-6">
                            
                            <!-- O restante do formulário é o que o fiscal preenche -->
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">Informações da Vistoria (Preenchimento do Fiscal)</h3>

                            <!-- Seção de Dados Gerais (O fiscal preenche/confirma) -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Proprietário / Inquilino</h4>
                                    <!-- **MUDANÇA NA FONTE**: Adicionado 'text-sm' -->
                                    <div class="flex space-x-4"><label class="flex items-center text-sm"><input type="radio" name="proprietario" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2" checked>Proprietário</label><label class="flex items-center text-sm"><input type="radio" name="proprietario" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">Inquilino</label><label class="flex items-center text-sm"><input type="radio" name="proprietario" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">Outro</label></div>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Local da Árvore</h4>
                                    <!-- **MUDANÇA NA FONTE**: Adicionado 'text-sm' -->
                                    <div class="flex space-x-4"><label class="flex items-center text-sm"><input type="radio" name="local" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">Interno</label><label class="flex items-center text-sm"><input type="radio" name="local" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2" checked>Externo (Calçada)</label></div>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-700 mb-2">Tipo de Imóvel</h4>
                                    <!-- **MUDANÇA NA FONTE**: Adicionado 'text-sm' -->
                                    <div class="flex space-x-4"><label class="flex items-center text-sm"><input type="radio" name="imovel" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2" checked>Residencial</label><label class="flex items-center text-sm"><input type="radio" name="imovel" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">Comercial</label><label class="flex items-center text-sm"><input type="radio" name="imovel" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">Industrial</label><label class="flex items-center text-sm"><input type="radio" name="imovel" class="h-4 w-4 text-green-600 border-gray-300 focus:ring-green-500 mr-2">Terreno</label></div>
                                </div>
                            </div>

                            <!-- Seção de Quantidade e Espécies -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label class="font-semibold text-gray-700">Qtd. Árvores a Suprimir (Decisão)</label>
                                    <input type="number" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" value="1">
                                </div>
                                <div>
                                    <label class="font-semibold text-gray-700">Qtd. Árvores a Podar (Decisão)</label>
                                    <input type="number" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" value="0">
                                </div>
                                <div class="col-span-1 md:col-span-2">
                                    <label class="font-semibold text-gray-700">Espécie(s) Identificada(s)</label>
                                    <input type="text" class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Ex: Sibipiruna, Oiti...">
                                </div>
                            </div>

                            <!-- Seção de Critérios (baseado no laudo) -->
                            <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-4 border-b pb-2">Critérios de Análise (Checklist do Fiscal)</h3>
                            <!-- **MUDANÇA ESTRUTURAL**: Removido o grid, agora os itens são empilhados verticalmente -->
                            <div class="space-y-4 mb-6 text-sm">
                                <!-- 1. Incompatibilidade -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-gray-700 mb-3">1. INCOMPATIBILIDADE</h4>
                                    <div class="space-y-3"><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Estragos irreparáveis na calçada</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Danos à rede de esgoto e/ou água</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Danos na estrutura da construção</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Restrição na passagem de pedestres</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2" checked>Conflito com a fiação elétrica</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Porte ou espécie inadequada/tóxica</label></div>
                                </div>
                                <!-- 2. Estado Fitossanitário -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-gray-700 mb-3">2. ESTADO FITOSSANITÁRIO</h4>
                                    <div class="space-y-3"><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Presença de pragas irremediáveis</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Atacada por plantas parasitas</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Apodrecimento por doenças</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Árvore senescente / debilitada</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Árvore morta</label></div>
                                </div>
                                <!-- 3. Obras e Emergência -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-gray-700 mb-3">3. OBRAS</h4>
                                    <div class="space-y-3 mb-4"><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Implantação de obras/projetos</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Entrada e saída de veículos</label></div>
                                    <h4 class="font-bold text-gray-700 mb-3">4. EMERGÊNCIA</h4>
                                    <div class="space-y-3"><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2" checked>Risco iminente (população/patrimônio)</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Galhos ou árvores caindo / já caída</label></div>
                                </div>
                            </div>

                            <!-- Seção de Anotações e Observações -->
                            <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-4 border-b pb-2">Parecer Técnico e Observações Finais</h3>
                            <!-- **MUDANÇA ESTRUTURAL**: Removido o grid, agora os itens são empilhados verticalmente -->
                            <div class="space-y-6 mb-6">
                                <div>
                                    <label class="font-semibold text-gray-700 mb-2 block">Anotações de Campo / Parecer Técnico</label>
                                    <textarea id="fiscalNotes" rows="8" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm" placeholder="Descreva sua avaliação técnica... (Obrigatório para aprovar/rejeitar)"></textarea>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-700 mb-3">Outras Observações (Checklist)</h4>
                                    <!-- **MUDANÇA ESTRUTURAL**: Adicionado grid de 2 colunas para organizar a lista -->
                                    <div class="space-y-3 text-sm grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3">
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Árvore de vizinho</input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Árvore na divisa</input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Abelhas COM ferrão</input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Abelhas SEM ferrão</input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Ninho</input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Aumentar requadro</input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Poda drástica anterior</label></input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Endereço incompleto</label></input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Endereço não encontrado</label></input></label>
                                        <label class="flex items-center"><input type="checkbox" class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500 mr-2">Endereço errado</label></input></label>
                                    </div>
                                </div>
                            </div>

                            <!-- **CORREÇÃO DE BUG**: Removida a seção duplicada de "Parecer Técnico" que estava aqui -->

                            <!-- **NOVO CAMPO** Seção de Reposição / Compensação -->
                            <h3 class="text-lg font-semibold text-gray-800 mt-6 mb-4 border-b pb-2">Reposição / Compensação</h3>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="flex flex-wrap items-center gap-4 text-sm">
                                    <span>Será(ão) suprimida(s)</span>
                                    <input type="number" class="w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" value="1">
                                    <span>árvore(s) e substituída(s) por</span>
                                    <input type="number" class="w-20 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" value="1Um">
                                    <span>muda(s) de árvore(s) de</span>
                                    <input type="text" class="w-32 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Ex: Pequeno">
                                    <span>porte.</span>
                                </div>
                            </div>
                        </form>
                    </fieldset>
                </div>

            </div>
            
            <!-- Rodapé do Modal com Botões de Ação -->
            <!-- **MUDANÇA** Criei dois rodapés, um para 'pendente' e outro para 'readonly' -->
            
            <!-- Rodapé para Ações Pendentes (EDITÁVEL) -->
            <div id="modal-actions-pending" class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 flex-shrink-0">
                <button onclick="closeModal()" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Cancelar</button>
                <button onclick="showToast('Rascunho salvo!', 'success')" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Salvar Rascunho</button>
                <button onclick="closeModalWithMessage('Solicitação Rejeitada com sucesso!', 'error')" class="w-full sm:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Rejeitar</button>
                <button onclick="closeModalWithMessage('Solicitação Aprovada com sucesso!', 'success')" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Aprovar Laudo</button>
            </div>

             <!-- Rodapé para Modo Leitura (READ-ONLY) -->
            <div id="modal-actions-readonly" class="hidden px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end flex-shrink-0">
                <button onclick="closeModal()" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Fechar</button>
            </div>
        </div>
    </div>

    <!-- ====================================================================== -->
    <!-- ELEMENTO DA NOTIFICAÇÃO (TOAST) (Sem alterações)                       -->
    <!-- Fica aqui no final do body, mas é posicionado na tela via CSS.         -->
    <!-- ====================================================================== -->
    <div id="toast" class="p-4 rounded-lg text-white shadow-lg">
        <span id="toast-message"></span>
    </div>

    <!-- ====================================================================== -->
    <!-- SCRIPT JAVASCRIPT GERAL (COM ADIÇÕES)                                  -->
    <!-- Todo o cérebro da nossa página interativa fica aqui.                   -->
    <!-- ====================================================================== -->
    <script>
        // --- 1. LÓGICA DE NAVEGAÇÃO ENTRE TELAS ---
        // Pega todos os elementos que têm a classe 'screen' e guarda numa lista.
        const screens = document.querySelectorAll('.screen');
        // Função para mostrar uma tela específica e esconder as outras.
        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.style.display = 'none'; // Esconde todas.
            });
            const activeScreen = document.getElementById(screenId); // Pega a tela que queremos mostrar.
            if (activeScreen) {
                // Telas de login e recuperação são centralizadas com flexbox, o painel principal não.
                activeScreen.style.display = (screenId === 'login-screen' || screenId === 'esqueci-senha-screen') ? 'flex' : 'block';
            }
        }

        // --- 2. LÓGICA DO MODAL (JANELA DE ANÁLISE) ---
        // **MUDANÇA** Pega os novos elementos do modal
        const modal = document.getElementById('requestModal');
        const modalProtocol = document.getElementById('modalProtocol');
        const laudoFieldset = document.getElementById('laudo-fieldset'); // O fieldset que trava o formulário
        const modalActionsPending = document.getElementById('modal-actions-pending'); // Botões de ação
        const modalActionsReadOnly = document.getElementById('modal-actions-readonly'); // Botão de fechar

        // **MUDANÇA** A função agora aceita 'isReadOnly'
        function openModal(protocol, isReadOnly = false) {
            modalProtocol.textContent = protocol; // Coloca o número do protocolo no título.
            
            // Lógica para mostrar/esconder botões e travar/destravar o formulário
            if (isReadOnly) {
                // MODO LEITURA (clicou em "Ver")
                laudoFieldset.disabled = true; // Trava todos os inputs, selects, textareas dentro do fieldset
                modalActionsPending.classList.add('hidden'); // Esconde botões de Ação
                modalActionsReadOnly.classList.remove('hidden'); // Mostra SÓ o botão de Fechar
            } else {
                // MODO DE ANÁLISE (clicou em "Analisar")
                laudoFieldset.disabled = false; // Garante que o formulário esteja destravado
                modalActionsPending.classList.remove('hidden'); // Mostra botões de Ação
                modalActionsReadOnly.classList.add('hidden'); // Esconde o botão de Fechar
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.classList.add('overflow-hidden'); // Trava a rolagem da página de fundo.
            showTab('tab-detalhes'); // Garante que a primeira aba sempre seja mostrada ao abrir.
        }

        function closeModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.classList.remove('overflow-hidden'); // Libera a rolagem.
        }

        function closeModalWithMessage(message, type) {
            closeModal();
            showToast(message, type); // Em vez de alert(), chama nossa nova função de notificação.
        }

        // --- 3. LÓGICA DAS ABAS DO MODAL ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        function showTab(tabId) {
            // Primeiro, esconde todos os conteúdos de aba
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            // Remove o estilo 'active' de todos os botões de aba
            tabButtons.forEach(button => {
                button.classList.remove('active', 'text-gray-600');
                // Adiciona a cor cinza padrão para botões inativos
                if (!button.classList.contains('active')) {
                    button.classList.add('text-gray-600');
                }
            });
            
            // Agora, mostra o conteúdo da aba clicada
            const activeContent = document.getElementById(tabId);
            if (activeContent) {
                activeContent.classList.add('active');
            }
            
            // Adiciona o estilo 'active' ao botão clicado
            let activeButton;
            if (event && event.target) {
                 activeButton = event.target;
            } else {
                // Encontra o botão que corresponde ao tabId
                activeButton = document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`);
            }
            
            if(activeButton) {
                activeButton.classList.add('active');
                activeButton.classList.remove('text-gray-600');
            }
        }


        // --- 4. LÓGICA DA NOTIFICAÇÃO (TOAST) ---
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        function showToast(message, type = 'success') {
            toastMessage.textContent = message; // Define a mensagem.
            // Remove classes de cor antigas e adiciona a nova.
            toast.classList.remove('bg-green-500', 'bg-red-500', 'bg-blue-500');
            if (type === 'success') {
                toast.classList.add('bg-green-500');
            } else if (type === 'error') {
                toast.classList.add('bg-red-500');
            } else {
                toast.classList.add('bg-blue-500'); // Tipo 'info' ou padrão
            }
            
            toast.classList.add('show'); // Mostra a notificação.
            // Depois de 3 segundos, esconde a notificação novamente.
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // --- 5. LÓGICAS DE FORMULÁRIO E INTERAÇÃO ---
        // Função para simular carregamento em botões
        function simulateLoading(button, originalContent, duration = 1500) {
            // Desabilita o botão e mostra o ícone de carregamento.
            button.disabled = true;
            button.innerHTML = `<svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="10" stroke-width="4" stroke="currentColor" class="opacity-25"></circle><path d="M4 12a8 8 0 018-8" stroke-width="4" stroke="currentColor" class="opacity-75"></path></svg> Carregando...`;
            
            // Depois do tempo definido, reverte o botão ao estado original.
            setTimeout(() => {
                button.disabled = false;
                button.innerHTML = originalContent;
            }, duration);
        }

        // Simulação de login
        const loginForm = document.getElementById('login-form');
        const loginButton = document.getElementById('login-button');
        const originalLoginButtonContent = loginButton.innerHTML;
        loginForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Impede o recarregamento da página.
            simulateLoading(loginButton, originalLoginButtonContent, 1500);
            setTimeout(() => showScreen('fiscal-screen'), 1500); // Mostra o painel após o "loading".
        });

        // Simulação de filtro
        const filterForm = document.getElementById('filter-form');
        const filterButton = document.getElementById('filter-button');
        const originalFilterButtonContent = filterButton.innerHTML;
        filterForm.addEventListener('submit', function(event) {
            event.preventDefault();
            simulateLoading(filterButton, originalFilterButtonContent, 1000);
            setTimeout(() => showToast('Filtros aplicados!', 'success'), 1000);
        });

        // Visibilidade da senha
        const togglePasswordButton = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        togglePasswordButton.addEventListener('click', function() {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            document.getElementById('eye-icon').classList.toggle('hidden');
            document.getElementById('eye-slash-icon').classList.toggle('hidden');
        });

        // Máscara de CPF
        document.querySelectorAll('.cpf-mask').forEach(input => {
            input.addEventListener('input', function (e) {
                let value = e.target.value.replace(/\D/g, ''); // Remove tudo que não for dígito.
                // Aplica a formatação do CPF: 000.000.000-00
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            });
        });

        // --- 6. INICIALIZAÇÃO ---
        // Garante que a tela de login seja a primeira a ser exibida quando a página carregar.
        document.addEventListener('DOMContentLoaded', () => {
            showScreen('login-screen');
        });
    </script>
</body>
</html>

